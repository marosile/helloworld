<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="boardMapper">

	<!-- 임시 -->
	<resultMap type="Board" id="boardResultMap">

		<id property="boardNo" column="BOARD_NO" />

		<result property="boardTitle" column="BOARD_TITLE" />
		<result property="boardContent" column="BOARD_CONTENT" />
		<result property="createDate" column="CREATE_DT" />
		<result property="modifyDate" column="MODIFY_DT" />
		<result property="deletedFl" column="DELETED_FL" />
		<result property="memberId" column="MEMBER_ID" />
		<result property="memberNickname" column="MEMBER_NICK" />
		<result property="boardCode" column="BOARD_CODE" />
		<result property="boardName" column="BOARD_NAME" />

	</resultMap>
	
	
	<select id="loadPost" resultMap="boardResultMap">
	   		SELECT * FROM (
			    SELECT A.*, ROWNUM AS rnum FROM (
			        SELECT B.BOARD_NO, B.MEMBER_ID, B.BOARD_TITLE, B.BOARD_CONTENT, B.CREATE_DT, B.MODIFY_DT, B.DELETED_FL, B.READ_COUNT, M.MEMBER_NICK, BG.BOARD_CODE 
			        FROM BOARD B
			        JOIN MEMBER M ON B.MEMBER_ID = M.MEMBER_ID
			        JOIN BOARD_GENERAL BG ON B.BOARD_NO = BG.BOARD_NO
			        WHERE BG.BOARD_CODE = #{boardCode}
			        ORDER BY B.BOARD_NO DESC
			    ) A 
			)
			WHERE rnum BETWEEN #{start} AND #{end}
	</select>
	
	
	<select id="selectBoardList" resultMap="boardResultMap">
			SELECT B.BOARD_NO, B.MEMBER_ID, B.BOARD_TITLE, B.BOARD_CONTENT, B.CREATE_DT, B.MODIFY_DT, B.DELETED_FL, BG.BOARD_CODE
			FROM BOARD B
			JOIN BOARD_GENERAL BG ON (B.BOARD_NO = BG.BOARD_NO)
			WHERE BG.BOARD_CODE = #{boardCode}
			ORDER BY B.BOARD_NO DESC
	</select>
	
	<select id="selectBoard" resultMap="boardResultMap">
			SELECT B.BOARD_NO, B.MEMBER_ID, B.BOARD_TITLE, B.BOARD_CONTENT, B.CREATE_DT, B.MODIFY_DT, B.DELETED_FL, B.READ_COUNT, M.MEMBER_NICK, BG.BOARD_CODE
			FROM BOARD B
			JOIN MEMBER M ON (B.MEMBER_ID = M.MEMBER_ID)
			JOIN BOARD_GENERAL BG ON (B.BOARD_NO = BG.BOARD_NO)
			WHERE B.BOARD_NO = #{boardNo}
			AND BG.BOARD_CODE = #{boardCode}
	</select>
	
	<insert id="boardInsert" parameterType="Board" useGeneratedKeys="true">
		
		<selectKey order="BEFORE" resultType="_int"
			keyProperty="boardNo">
			SELECT SEQ_BOARD_NO.NEXTVAL FROM DUAL
		</selectKey>
	
		INSERT ALL
		
		INTO BOARD (BOARD_NO, MEMBER_ID, BOARD_TITLE, BOARD_CONTENT, CREATE_DT, DELETED_FL, READ_COUNT)
		VALUES(#{boardNo}, #{memberId}, #{boardTitle}, #{boardContent}, DEFAULT, DEFAULT, #{boardCode})
			
		INTO BOARD_GENERAL (BOARD_NO, BOARD_CODE) VALUES(#{boardNo}, #{boardCode})
		
		
		
		SELECT 1 FROM DUAL

	</insert>


</mapper>
