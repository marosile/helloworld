<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="memberMapper">

    <!-- 멤버 resultMap -->
    <resultMap id="member_rm" type="Member">

        <id property="memberId" column="MEMBER_ID"/>

        <result property="memberPw" column="MEMBER_PW"/>
        <result property="memberNick" column="MEMBER_NICK"/>
        <result property="memberEmail" column="MEMBER_EMAIL"/>
        <result property="memberTel" column="MEMBER_TEL"/>
        <result property="profileImg" column="PROFILE_IMG"/>
        <result property="enrollDate" column="ENROLL_DT"/>
        <result property="promotionFl" column="PROMOTION_FL"/>
        <result property="deleteFl" column="DELETED_FL"/>

    </resultMap>

    <!-- 로그인 -->
    <select id="login" resultMap="member_rm" parameterType="Member">
        SELECT MEMBER_ID, MEMBER_PW, MEMBER_NICK, MEMBER_EMAIL, MEMBER_TEL, PROFILE_IMG,
               TO_CHAR(ENROLL_DT, 'YYYY"년" MM"월" DD"일" HH24"시" MI"분" SS"초"') ENROLL_DT,
               PROMOTION_FL
        FROM "MEMBER"
        WHERE DELETED_FL = 'N'
        AND MEMBER_ID = #{memberId}
    </select>

    <!-- 회원가입 -->
    <insert id="signUp" parameterType="Member">
        INSERT INTO "MEMBER"
        VALUES(#{memberId},
               #{memberPw},
               #{memberNick},
               #{memberEmail},
               #{memberTel},
               #{profileImg},
               DEFAULT,
               #{promotionFl},
               DEFAULT)
    </insert>

    <!-- 아이디 중복 체크 -->
    <select id="dupId" parameterType="string" resultType="_int">
        SELECT COUNT(*) FROM "MEMBER"
        WHERE MEMBER_ID = #{memberId}
        AND DELETED_FL = 'N'
    </select>

    <!-- 이메일 중복 체크 -->
    <select id="dupEmail" parameterType="string" resultType="_int">
        SELECT COUNT(*) FROM "MEMBER"
        WHERE MEMBER_EMAIL = #{memberEmail}
        AND DELETED_FL = 'N'
    </select>

    <!-- 전화번호 중복 체크 -->
    <select id="dupTel" parameterType="string" resultType="_int">
        SELECT COUNT(*) FROM "MEMBER"
        WHERE MEMBER_TEL = #{memberTel}
        AND DELETED_FL = 'N'
    </select>

    <!-- 카카오 로그인(이메일) -->
    <select id="snsLogin" resultMap="member_rm" parameterType="Member">
        SELECT MEMBER_ID, MEMBER_PW, MEMBER_NICK, MEMBER_EMAIL, MEMBER_TEL, PROFILE_IMG,
               TO_CHAR(ENROLL_DT, 'YYYY"년" MM"월" DD"일" HH24"시" MI"분" SS"초"') ENROLL_DT,
               PROMOTION_FL
        FROM "MEMBER"
        WHERE DELETED_FL = 'N'
        AND MEMBER_EMAIL = #{memberEmail}
    </select>
    
    <!-- 카카오 프로필 이미지로 변경 -->
    <update id="imgChange" parameterType="string">
        UPDATE "MEMBER"
        SET PROFILE_IMG = #{profileImg}
        WHERE MEMBER_EMAIL = #{memberEmail}
    </update>

    <!-- 전화번호로 아이디 찾기 -->
    <select id="findIdTel" parameterType="string" resultType="string">
        SELECT MEMBER_ID
        FROM "MEMBER"
        WHERE MEMBER_TEL=#{inputTel}
        AND DELETED_FL = 'N'
    </select>

    
</mapper>
